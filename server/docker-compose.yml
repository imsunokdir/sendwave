# version: "3.8"

# services:
#   elasticsearch:
#     image: docker.elastic.co/elasticsearch/elasticsearch:8.15.0
#     container_name: es-onebox
#     environment:
#       - discovery.type=single-node
#       - xpack.security.enabled=false
#       - ES_JAVA_OPTS=-Xms512m -Xmx512m
#     ports:
#       - "9200:9200"
#     volumes:
#       - esdata:/usr/share/elasticsearch/data
#     networks:
#       - email-network

#   chromadb:
#     image: chromadb/chroma:latest
#     container_name: chromadb-onebox
#     environment:
#       - IS_PERSISTENT=TRUE
#       - ANONYMIZED_TELEMETRY=FALSE
#       - CHROMA_SERVER_CORS_ALLOW_ORIGINS=*
#     ports:
#       - "8000:8000"
#     volumes:
#       - chromadata:/chroma/chroma
#     networks:
#       - email-network

# volumes:
#   esdata:
#     driver: local
#   chromadata:
#     driver: local

# networks:
#   email-network:
#     driver: bridge

version: "3.8"

services:
  elasticsearch:
    image: docker.elastic.co/elasticsearch/elasticsearch:8.15.0
    container_name: es-onebox
    environment:
      - discovery.type=single-node
      - xpack.security.enabled=false
      - ES_JAVA_OPTS=-Xms512m -Xmx512m
    ports:
      - "9200:9200"
    volumes:
      - esdata:/usr/share/elasticsearch/data
    networks:
      - email-network

  chromadb:
    image: chromadb/chroma:latest
    container_name: chromadb-onebox
    environment:
      - IS_PERSISTENT=TRUE
      - ANONYMIZED_TELEMETRY=FALSE
      - CHROMA_SERVER_CORS_ALLOW_ORIGINS=*
    ports:
      - "8000:8000"
    volumes:
      - chromadata:/chroma/chroma
    networks:
      - email-network

  backend:
    build: .
    container_name: backend-onebox
    env_file:
      - .env
    ports:
      - "5000:5000"
    networks:
      - email-network
    depends_on:
      - elasticsearch
      - chromadb

  frontend:
    build: ../client
    container_name: frontend-onebox
    ports:
      - "3000:80" # maps container port 80 â†’ host port 3000
    networks:
      - email-network
    depends_on:
      - backend

networks:
  email-network:
    driver: bridge

volumes:
  esdata:
    driver: local
  chromadata:
    driver: local
